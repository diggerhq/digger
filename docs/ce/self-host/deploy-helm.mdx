---
title: "Kubernetes via Helm"
description: "Learn how to use Helm chart to install Digger on your Kubernetes cluster."
---

**Prerequisites**
- You have extensive understanding of [Kubernetes](https://kubernetes.io/)
- Installed [Helm package manager](https://helm.sh/) version v3.11.3 or greater
- You have [kubectl](https://kubernetes.io/docs/reference/kubectl/kubectl/) installed and connected to your kubernetes cluster
- A domain name for ingress configuration
- A GitHub organization where you'll install the GitHub App

<Steps>
  <Step title="Create Helm values">
    Create a `values.yaml` file. This will be used to configure settings for the Digger Helm chart.
    To explore all configurable properties for your values file, visit the [values.yaml reference](https://github.com/diggerhq/digger/blob/develop/helm-charts/digger-backend/values.yaml).
  </Step>

  <Step title="Select Digger version">
    By default, the Digger version set in your helm chart will likely be outdated.
    Choose the latest Digger docker image tag from the [releases page](https://github.com/diggerhq/digger/releases).
    
    ```yaml values.yaml
    digger:
      image:
        repository: registry.digger.dev/diggerhq/digger_backend
        tag: "v0.6.110" # Select tag from GitHub releases
        pullPolicy: IfNotPresent
    ```
    
    <Warning>
      Do not use the latest docker image tag in production deployments as they can introduce unexpected changes
    </Warning>
  </Step>


  <Step title="Configure database">
    Choose your database configuration based on your environment:
    
    <Tabs>
      <Tab title="External PostgreSQL (Production)">
        For production environments, use an external PostgreSQL database:
        
        ```yaml values.yaml
        digger:
          postgres:
            user: "digger"
            database: "digger"
            host: "postgresql.example.com"
            password: "secure-password"
            sslmode: "require"  # or "disable"
        ```
      </Tab>
      
      <Tab title="Built-in PostgreSQL (Testing Only)">
        For test or proof-of-concept purposes, you can use the built-in PostgreSQL:
        
        ```yaml values.yaml
        postgres:
          enabled: true
          secret:
            useExistingSecret: false  # Important: set to false
            password: "<test-password>"
        ```
        
        <Warning>
          Built-in PostgreSQL is only recommended for testing purposes
        </Warning>
      </Tab>
    </Tabs>
  </Step>

  <Step title="Configure ingress">
    Configure ingress to route traffic to Digger (required for GitHub App setup):
    
    ```yaml values.yaml
    digger:
      ingress:
        enabled: true
        host: "digger.example.com"  # Your domain
        annotations:
          # Add annotations based on your ingress controller
          # Example for nginx:
          # kubernetes.io/ingress.class: "nginx"
          # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    ```
  </Step>

  <Step title="Configure initial secrets">
    Configure the authentication and hostname settings:
    
    ```yaml values.yaml
    digger:
      secret:
        httpBasicAuthUsername: "admin"
        httpBasicAuthPassword: "<strong-password>"  # CHANGE THIS
        bearerAuthToken: "<strong-token>"          # CHANGE THIS
        hostname: "https://digger.example.com"     # Include https:// prefix!
        githubOrg: "your-github-org"               # Your GitHub organization name
        
        # GitHub App credentials - leave empty for now
        githubAppID: ""
        githubAppClientID: ""
        githubAppClientSecret: ""
        githubAppKeyFile: ""
        githubWebhookSecret: ""
    ```
    
    <Note>
      **Hostname configuration is different from ingress:**
      - Ingress host: `digger.example.com` (no protocol)
      - Secret hostname: `https://digger.example.com` (requires https:// prefix)
      
      For example:
      - If your ingress host is `digger.35.232.52.175.nip.io`
      - Your secret hostname should be `https://digger.35.232.52.175.nip.io`
    </Note>
    
    <Warning>
      **Important**: 
      - The `githubOrg` must be your actual GitHub organization name where you'll install the app
      - Change all default passwords and tokens
    </Warning>
  </Step>

  <Step title="Install the Helm chart">
    Once you are done configuring your `values.yaml` file, run the command below to install Digger:
    
    ```bash
    helm install digger-backend oci://ghcr.io/diggerhq/helm-charts/digger-backend \
      --namespace digger \
      --create-namespace \
      --values values.yaml
    ```
    
    Wait for all pods to reach a running state:
    
    ```bash
    kubectl get pods -n digger
    ```
  </Step>

  <Step title="Create GitHub App">
    Navigate to your Digger hostname to create the GitHub App:
    
    1. Go to `https://your-digger-hostname/github/setup`
    2. Follow the web interface to create your GitHub App
    3. The page will display your app credentials
    
    ![Digger GitHub App Setup Success](/images/digger-github-app-wizard.png)
    
    <Note>
      **Don't close this tab yet!** You'll need these credentials in the next steps.
    </Note>
  </Step>

  <Step title="Update configuration with GitHub App credentials">
    Add the GitHub App credentials to your `values.yaml` file:
    
    ```yaml values.yaml
    digger:
      secret:
        # ... existing configuration ...
        githubOrg: "your-github-org"
        githubAppID: "123456"
        githubAppClientID: "Iv1.abc123def456"
        githubAppClientSecret: "github_app_client_secret"
        githubAppKeyFile: "LS0tLS1CRUdJTi..."  # base64 encoded private key
        githubWebhookSecret: "webhook_secret"
    ```
    
    Then upgrade the Helm release:
    
    ```bash
    helm upgrade digger-backend oci://ghcr.io/diggerhq/helm-charts/digger-backend \
      --namespace digger \
      --values values.yaml
    ```
  </Step>

  <Step title="Install GitHub App">
    Click the installation link shown in the GitHub App creation wizard:
    
    - The link will look like: `https://github.com/apps/your-digger-app-name/installations/new`
    - Install the app in your GitHub organization
    - Select which repositories the app can access
    
    After installation, you can verify everything is working by creating a pull request with Terraform/OpenTofu files and commenting `digger plan`.
  </Step>

</Steps>

## Advanced Configuration

<Accordion title="Using existing secrets">
  If you prefer to manage secrets separately, you can reference an existing Kubernetes secret:
  
  ```yaml values.yaml
  digger:
    secret:
      useExistingSecret: true
      existingSecretName: "digger-secrets"
  ```
</Accordion>

<Accordion title="Resource configuration">
  Configure resource limits and requests:
  
  ```yaml values.yaml
  digger:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
  ```
</Accordion>

<Accordion title="Full values.yaml example">
  ```yaml values.yaml
  digger:
    image:
      repository: registry.digger.dev/diggerhq/digger_backend
      tag: "v0.6.106"
      pullPolicy: IfNotPresent
    
    service:
      type: ClusterIP
      port: 3000
    
    ingress:
      enabled: true
      host: "digger.example.com"
      annotations:
        kubernetes.io/ingress.class: "nginx"
        cert-manager.io/cluster-issuer: "letsencrypt-prod"
    
    secret:
      httpBasicAuthUsername: "admin"
      httpBasicAuthPassword: "secure-password-123"
      bearerAuthToken: "secure-bearer-token-456"
      hostname: "https://digger.example.com"  # Include https:// prefix
      
      githubOrg: "your-github-org"
      githubAppID: "123456"
      githubAppClientID: "Iv1.abc123def456"
      githubAppClientSecret: "github_app_client_secret"
      githubAppKeyFile: "LS0tLS1CRUdJTi..."
      githubWebhookSecret: "webhook_secret"
    
    postgres:
      user: "digger"
      database: "digger"
      host: "postgresql.example.com"
      password: "postgres-password"
      sslmode: "require"
    
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
  
  # For testing only - use external database in production
  postgres:
    enabled: false
    # If you enable the built-in postgres:
    # secret:
    #   useExistingSecret: false
    #   password: "test-password"
  ```
</Accordion>