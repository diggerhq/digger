---
title: "Quickstart"
---

Here's how to do a quickstart for OpenTaco with Auth0 and S3.

## CLI Install (WIP)

### On macOS 

The first thing you'll want to do is visit our releases page here https://github.com/diggerhq/digger/releases and check the latest taco/cli release. Right now it is v0.1.7

We can then do:

```bash
curl -L https://github.com/diggerhq/digger/releases/download/taco/cli/v0.1.7/taco-darwin-arm64 -o taco 
chmod +x taco 
sudo mv taco /usr/local/bin
```

Confirm Taco CLI is available with:

```bash
taco --help
```


For the best experience in your shell you can configure the following environment vars for the CLI:

```bash
export OPENTACO_SERVER=https://my-opentaco.company.com
export OPENTACO_AUTH_ISSUER=https://auth.company.com
export OPENTACO_AUTH_CLIENT_ID=my-client-id
```

The first one is the address of your server which we'll get to setting up later.

The last two are for OIDC setup. For now, let's setup Auth0.

## Setting up Auth0 

Navigate to https://auth0.com, create an account and sign in.

You're going to want to create a native app. Once you do that it'll take you to a screen where you can select a technology - we don't need this. You can instead go to settings.

For the CLI we need Domain and Client ID. For the OPENTACO_AUTH_ISSUER we want to use the Domain value. For the OPENTACO_AUTH_CLIENT_ID, we use the Client ID.

Once we have these values we can export them in our `.zshrc`, `.bashrc`, `.profile`, `.zprofile` or whatever is applicable on your platform.

## Setting up Statesman

The next thing you'll want to do is to setup Statesman - the state management service. 

First we'll want to make an env file for your service.

### Required Environment Variables

We'll need the values from the settings page of our Auth0 application:

```bash
OPENTACO_AUTH_ISSUER
OPENTACO_AUTH_CLIENT_ID
OPENTACO_AUTH_CLIENT_SECRET
```

Then we need to create two more:

```bash
OPENTACO_AUTH_AUTH_URL="https://{Your-Auth0-domain}/authorize"
OPENTACO_AUTH_TOKEN_URL="https://{Your-Auth0-domain}/oauth/token"
```

Note that these are specific to Auth0, if you use another provider they may use different endpoints. That is why they are defined separately and not computed.

The next values we need are from S3:

```bash
OPENTACO_S3_BUCKET=your-open-taco-bucket-name
OPENTACO_S3_PREFIX=a-folder-within-that-bucket
OPENTACO_S3_REGION=your-aws-region
```

And lastly the `OPENTACO_PUBLIC_BASE_URL` which is where you expect your service to be hosted that is public facing.

If you are running a load balancer, it is the public side of that load balancer.

If its a single server, it is the public endpoint.

If you are running it through ngrok on your local machine it is the ngrok url, not localhost.


### AWS CLI Credentials 

The final piece to have a working instalation is to get your AWS CLI credentials and set them as environment variables for Statesman. If you haven't set up the AWS CLI, you should do so before doing this step.

We'll run these commands

`aws configure get aws_access_key_id`<br />
`aws configure get aws_secret_access_key`<br /> 
`aws configure get region`<br />

and set then under the environment variables: 
`AWS_ACCESS_KEY_ID`,
`AWS_SECRET_ACCESS_KEY`,
and `AWS_DEFAUlT_REGION` respectively



### Complete Environment Configuration

We should have these values in our `.env` now:

```bash
OPENTACO_S3_BUCKET='your-bucket-name'  # not a uri, the name itself
OPENTACO_S3_REGION='aws-region' # like us-east-1
OPENTACO_S3_PREFIX='folder-name'
OPENTACO_AUTH_ISSUER='your-auth0-app-domain'
OPENTACO_AUTH_CLIENT_ID='your-auth0-app-clientid'
OPENTACO_AUTH_CLIENT_SECRET='your-auth0-app-client-secret'
OPENTACO_AUTH_AUTH_URL='{your-auth0-app-domain}/authorize'
OPENTACO_AUTH_TOKEN_URL='{your-auth0-app-domain}/oauth/token'
OPENTACO_PUBLIC_BASE_URL='https://public.url/opentaco'
AWS_ACCESS_KEY_ID='your-aws-access-key-id'
AWS_SECRET_ACCESS_KEY='your-aws-secret-access-key'
AWS_DEFAULT_REGION='your-cli-region'
```



## Docker Compose

Use the docker-compose.yml in examples:

```yaml
version: '3.8'

services:
  statesman:
    image: ${STATESMAN_IMAGE:-ghcr.io/diggerhq/digger/taco-statesman:latest}
    ports:
      - "${OPENTACO_PORT:-8080}:8080"
    env_file:
      - .env  # Copy from .env.example and customize
    volumes:
      # Optional: persist data if using file-based storage later
      - statesman-data:/app/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
    container_name: opentaco-statesman

volumes:
  statesman-data:
    driver: local
```

Place your `.env` in the same directory.

## Starting the Service

Run docker-compose up:

```bash
docker-compose up -d
```

You can check if it is running with:

```bash
curl http://localhost:8080/healthz
```

If it is "OK" you will see:

```json
{"service":"opentaco","status":"ok"}
```

## Next Steps

From here you can configure a reverse proxy if you are hosting this or if you want to test locally this is a good option as well.

You want to set the public endpoint of Statesman as the OPENTACO_SERVER environment variable for the CLI. 

## Setting up Cloud Block Authentication

Once your OpenTaco Statesman server is running, you can configure Terraform to use it as a cloud backend with authentication. This allows you to use the `cloud` block in your Terraform configuration instead of the traditional `backend` block.

### Prerequisites

1. OpenTaco server running on an https endpoint - locally you could write a simple proxy or use ngrok
2. Auth0 or OIDC provider configured (from previous steps)
3. Terraform CLI version 1.1+ (required for cloud block support)

### Authentication 

For cloud block authentication, you only need to authenticate once using Terraform's built-in login:

```bash
terraform login <your host> 
```

This command will:
1. Open your browser to OpenTaco's OAuth authorization page
2. Redirect you to your OIDC provider (Auth0, etc.) for authentication  
3. Return authorization code to OpenTaco
4. Store access/refresh tokens in `~/.terraform.d/credentials.tfrc.json`


### Configuring Your Terraform Project

Create a new Terraform configuration with the cloud block:

```hcl
terraform {
  # Configure OpenTaco as Terraform Cloud backend
  cloud {
    hostname = "localhost:8443"  # Replace with your OpenTaco server
    
    workspaces {
      name = "my-workspace"
    }
  }
}

# Example resource
resource "random_string" "example" {
  length  = 16
  special = false
}

output "random_value" {
  value = random_string.example.result
}
```

### Initialize and Test

Once configured, initialize your Terraform project:

```bash
terraform init
```

Terraform will:
1. Query `/.well-known/terraform.json` for service discovery
2. Use stored credentials for authentication
3. Automatically create the workspace if it doesn't exist
4. Configure the remote state backend

Test that everything works:

```bash
terraform plan
terraform apply
```

### Verifying Authentication

After running `terraform login`, you can verify your authentication status with any of these commands:

```bash
# Check authentication with taco CLI 
taco whoami --server http://localhost:8080

# List available workspaces
taco unit ls

# Check workspace status
taco unit status my-workspace
```

### Troubleshooting Authentication

**Re-authenticate if needed:**
```bash
# Force re-authentication with Terraform 
terraform login -force localhost:8080
```

**Check stored credentials:**
```bash
# View Terraform credentials (these are used by both Terraform and taco CLI)
cat ~/.terraform.d/credentials.tfrc.json
```

### Advanced Cloud Block Options

**Multiple workspaces with tags:**
```hcl
terraform {
  cloud {
    hostname = "localhost:8080"
    organization = "my-org"  # Optional
    
    workspaces {
      tags = ["app:web", "env:production"]
    }
  }
}
```

**Environment-specific configuration:**
```bash
export TF_CLOUD_HOSTNAME=localhost:8080
export TF_WORKSPACE=my-workspace
terraform init
```



