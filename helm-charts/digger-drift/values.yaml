# values.yaml
#
# This chart creates environment variables from these values.
# You can either:
#   1. Set values here (chart creates secrets automatically)
#   2. Use secret.useExistingSecret=true and create your own secret
#
# See secrets-example/drift.env for a complete example

drift:
  # Image configuration
  # Public image available at ghcr.io/diggerhq/digger/drift
  image:
    repository: ghcr.io/diggerhq/digger/drift
    tag: "latest"
    pullPolicy: "IfNotPresent"

  # Number of replicas
  replicaCount: 1

  # Custom environment variables
  customEnv: []
  #   - name: MY_CUSTOM_ENV
  #     value: "my-value"

  # Set the log level for the drift service
  # Creates: DIGGER_LOG_LEVEL
  # DEBUG will enable the debug logs, any other value will set it to INFO
  logLevel: "INFO"         # DIGGER_LOG_LEVEL

  # Service configuration
  # Creates: DIGGER_PORT (set automatically from port)
  service:
    type: ClusterIP
    port: 3000             # DIGGER_PORT

  # Ingress configuration
  ingress:
    enabled: false
    className: "nginx"
    annotations: {}
      # cert-manager.io/cluster-issuer: letsencrypt-prod
    host: "drift.example.com"
    path: /
    tls:
      secretName: "digger-drift-tls"

  # Liveness and startup probe settings
  livenessProbe:
    httpGet:
      path: /health
      port: 3004
    periodSeconds: 20

  startupProbe:
    httpGet:
      path: /health
      port: 3004
    failureThreshold: 30
    periodSeconds: 10
  
  readinessProbe:
    httpGet:
      path: /health
      port: 3004
    periodSeconds: 10

  # Resource limits
  resources: {}
  #  requests:
  #    cpu: 100m
  #    memory: 256Mi
  #  limits:
  #    cpu: 500m
  #    memory: 512Mi

  # Node selector
  nodeSelector: {}

  # Tolerations
  tolerations: []

  # Affinity
  affinity: {}

  # Drift service configuration
  # Creates: DIGGER_HOSTNAME, DIGGER_WEBHOOK_SECRET, DIGGER_APP_URL,
  #          DIGGER_DRIFT_REPORTER_HOSTNAME
  config:
    hostname: ""              # DIGGER_HOSTNAME (public URL for this drift service)
    webhookSecret: ""         # DIGGER_WEBHOOK_SECRET (32 char secret for webhook auth)
    appUrl: ""                # DIGGER_APP_URL (URL for Digger app UI)
    driftReporterHostname: "" # DIGGER_DRIFT_REPORTER_HOSTNAME (optional)

  # Sentry configuration (optional)
  # Creates: SENTRY_DSN
  sentry:
    dsn: ""                   # SENTRY_DSN

  # GitHub App configuration (get from https://github.com/settings/apps)
  # Creates: GITHUB_ORG, GITHUB_APP_ID, GITHUB_APP_CLIENT_ID,
  #          GITHUB_APP_CLIENT_SECRET, GITHUB_APP_PRIVATE_KEY_BASE64, GITHUB_WEBHOOK_SECRET
  # These are required for drift detection to work with GitHub
  github:
    org: ""                   # GITHUB_ORG (GitHub organization name)
    appID: ""                 # GITHUB_APP_ID
    appClientID: ""           # GITHUB_APP_CLIENT_ID
    appClientSecret: ""       # GITHUB_APP_CLIENT_SECRET
    appPrivateKey: ""         # GITHUB_APP_PRIVATE_KEY_BASE64 (base64 encoded private key)
    webhookSecret: ""         # GITHUB_WEBHOOK_SECRET

  # PostgreSQL configuration
  # Creates: POSTGRES_HOST, POSTGRES_PORT, POSTGRES_USER, POSTGRES_DB,
  #          POSTGRES_SSLMODE, POSTGRES_PASSWORD (if not using existingSecret)
  # The drift service uses the same database as the digger backend
  postgres:
    # Use existingSecret to pull password from an existing secret
    existingSecretName: ""
    existingSecretKey: "postgres-password"
    
    # Database connection details
    sslmode: "disable"        # POSTGRES_SSLMODE
    user: "postgres"          # POSTGRES_USER
    database: "digger"        # POSTGRES_DB
    host: "postgresql.default.svc.cluster.local"  # POSTGRES_HOST
    password: ""              # POSTGRES_PASSWORD
    port: "5432"              # POSTGRES_PORT

  # Secret configuration
  # Use an existing secret or let the chart create one from values above
  secret:
    useExistingSecret: false
    existingSecretName: ""

# Global configuration (optional)
global:
  imagePullSecrets: []
