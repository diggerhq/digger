suite: test deployment
templates:
  - deployment.yaml
tests:
  - it: should create a deployment
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: metadata.name
          value: RELEASE-NAME-taco-ui
      - equal:
          path: spec.replicas
          value: 1
  
  - it: should set correct container image
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: "ghcr.io/diggerhq/digger/taco-ui:v0.1.0"
  
  - it: should set environment variables when apiUrl is provided
    set:
      ui.env.apiUrl: "http://test-backend:8080"
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: VITE_API_URL
            value: "http://test-backend:8080"
  
  - it: should configure workos when secretName is provided
    set:
      ui.env.workos.secretName: "workos-test"
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: WORKOS_API_KEY
            valueFrom:
              secretKeyRef:
                name: workos-test
                key: api-key

